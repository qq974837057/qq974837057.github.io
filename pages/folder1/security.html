<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>前端安全 | 元气Blog</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/wind.png">
    <meta name="description" content="元气Joe的前端世界">
    
    <link rel="preload" href="/assets/css/0.styles.8a46e3d7.css" as="style"><link rel="preload" href="/assets/js/app.d50c72b0.js" as="script"><link rel="preload" href="/assets/js/2.7285e602.js" as="script"><link rel="preload" href="/assets/js/32.0acbefde.js" as="script"><link rel="prefetch" href="/assets/js/10.95e645d2.js"><link rel="prefetch" href="/assets/js/11.7a5bbaab.js"><link rel="prefetch" href="/assets/js/12.0bd756fe.js"><link rel="prefetch" href="/assets/js/13.c032609a.js"><link rel="prefetch" href="/assets/js/14.621e82f0.js"><link rel="prefetch" href="/assets/js/15.2bc7bb03.js"><link rel="prefetch" href="/assets/js/16.7b7424df.js"><link rel="prefetch" href="/assets/js/17.9a2f808e.js"><link rel="prefetch" href="/assets/js/18.2bb036cb.js"><link rel="prefetch" href="/assets/js/19.d8537971.js"><link rel="prefetch" href="/assets/js/20.c8e9e8fe.js"><link rel="prefetch" href="/assets/js/21.efec8fa1.js"><link rel="prefetch" href="/assets/js/22.3385e6bf.js"><link rel="prefetch" href="/assets/js/23.a260f1cf.js"><link rel="prefetch" href="/assets/js/24.69037aca.js"><link rel="prefetch" href="/assets/js/25.ebc4667f.js"><link rel="prefetch" href="/assets/js/26.d355b386.js"><link rel="prefetch" href="/assets/js/27.8c327e12.js"><link rel="prefetch" href="/assets/js/28.98128502.js"><link rel="prefetch" href="/assets/js/29.b35b9692.js"><link rel="prefetch" href="/assets/js/3.efa71162.js"><link rel="prefetch" href="/assets/js/30.d28a8fd7.js"><link rel="prefetch" href="/assets/js/31.2eab1cab.js"><link rel="prefetch" href="/assets/js/33.35108fd8.js"><link rel="prefetch" href="/assets/js/34.bd1353df.js"><link rel="prefetch" href="/assets/js/4.2ab80d3e.js"><link rel="prefetch" href="/assets/js/5.b6c9c262.js"><link rel="prefetch" href="/assets/js/6.d1cbcbdc.js"><link rel="prefetch" href="/assets/js/7.7f87f0fb.js"><link rel="prefetch" href="/assets/js/8.97df5136.js"><link rel="prefetch" href="/assets/js/9.80311f25.js">
    <link rel="stylesheet" href="/assets/css/0.styles.8a46e3d7.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/wind.png" alt="元气Blog" class="logo"> <span class="site-name can-hide">元气Blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="分类" class="dropdown-title"><span class="title">分类</span> <span class="arrow down"></span></button> <button type="button" aria-label="分类" class="mobile-dropdown-title"><span class="title">分类</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/folder1/html.html" class="nav-link">
  文章
</a></li><li class="dropdown-item"><!----> <a href="/pages/folder2/test4.html" class="nav-link">
  随笔
</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/qq974837057" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="分类" class="dropdown-title"><span class="title">分类</span> <span class="arrow down"></span></button> <button type="button" aria-label="分类" class="mobile-dropdown-title"><span class="title">分类</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/folder1/html.html" class="nav-link">
  文章
</a></li><li class="dropdown-item"><!----> <a href="/pages/folder2/test4.html" class="nav-link">
  随笔
</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/qq974837057" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>前端基础</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/folder1/html.html" class="sidebar-link">HTML</a></li><li><a href="/pages/folder1/css.html" class="sidebar-link">CSS</a></li><li><a href="/pages/folder1/js.html" class="sidebar-link">JS</a></li><li><a href="/pages/folder1/ts.html" class="sidebar-link">TS</a></li><li><a href="/pages/folder1/browser.html" class="sidebar-link">HTTP与浏览器</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>前端进阶</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/folder1/security.html" aria-current="page" class="active sidebar-link">前端安全</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/folder1/security.html#前端安全" class="sidebar-link">前端安全</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/folder1/security.html#xss-跨站脚本攻击" class="sidebar-link">XSS：跨站脚本攻击</a></li><li class="sidebar-sub-header"><a href="/pages/folder1/security.html#csrf-xsrf-跨站请求伪造" class="sidebar-link">CSRF/XSRF: 跨站请求伪造</a></li><li class="sidebar-sub-header"><a href="/pages/folder1/security.html#使用沙箱安全的执行用户-js-代码" class="sidebar-link">使用沙箱安全的执行用户 js 代码</a></li><li class="sidebar-sub-header"><a href="/pages/folder1/security.html#网络劫持" class="sidebar-link">网络劫持</a></li><li class="sidebar-sub-header"><a href="/pages/folder1/security.html#json-劫持-json-hijacking" class="sidebar-link">JSON 劫持(JSON Hijacking)</a></li></ul></li></ul></li><li><a href="/pages/folder1/monitor.html" class="sidebar-link">监控体系</a></li><li><a href="/pages/folder1/performance.html" class="sidebar-link">性能优化</a></li><li><a href="/pages/folder1/design-pattern.html" class="sidebar-link">设计模式和架构</a></li><li><a href="/pages/folder1/refactor.html" class="sidebar-link">代码重构之道</a></li><li><a href="/pages/folder1/nodejs.html" class="sidebar-link">node与前沿</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>前端框架</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/folder1/frame-common.html" class="sidebar-link">框架通识</a></li><li><a href="/pages/folder1/frame.html" class="sidebar-link">框架-Vue</a></li><li><a href="/pages/folder1/react.html" class="sidebar-link">框架-React</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>工程化和协作</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/folder1/webpack.html" class="sidebar-link">Webpack</a></li><li><a href="/pages/folder1/normalize.html" class="sidebar-link">前端规范</a></li><li><a href="/pages/folder1/git.html" class="sidebar-link">Git</a></li><li><a href="/pages/folder1/build.html" class="sidebar-link">构建</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>算法与编程</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/folder1/algorithm-data.html" class="sidebar-link">数据结构和算法-概念</a></li><li><a href="/pages/folder1/algorithm-sort.html" class="sidebar-link">数据结构和算法-排序专题</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="前端安全"><a href="#前端安全" class="header-anchor">#</a> 前端安全</h2> <h3 id="xss-跨站脚本攻击"><a href="#xss-跨站脚本攻击" class="header-anchor">#</a> XSS：跨站脚本攻击</h3> <ul><li>如何攻击：在 URL 或者页面输入框中插入恶意 JS 代码，用户访问时完成攻击，如获取 cookie、监听用户按键等。</li> <li>存储型：将恶意代码存入服务器的数据库，如发表文章、评论、设置标题等，用户访问页面该内容即会触发，比较危险。属于服务端的安全漏洞。是持久化的。</li> <li>反射型：恶意代码存在 URL 上，如带参数的搜索，钓鱼邮件引诱点击 URL，服务器取出恶意代码并拼在 HTML 中返回浏览器，属于服务端的安全漏洞。是非持久化的。</li> <li>DOM 型：构造包含恶意代码的 URL，前端取出 URL 的恶意代码，不小心地执行了该代码，获取用户数据，调用相关接口，属于前端代码漏洞。</li></ul> <div class="language-html extra-class"><pre class="language-html"><code><span class="token comment">&lt;!-- 链接内包含恶意代码 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>代码<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token comment">// setTimeout()/setInterval() 中调用恶意代码</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token string">&quot;恶意代码&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token string">&quot;恶意代码&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// location 调用恶意代码</span>
  location<span class="token punctuation">.</span>href <span class="token operator">=</span> <span class="token string">&quot;恶意代码&quot;</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><ul><li>反射型 XSS 跟存储型 XSS 的区别：存储型 XSS 的恶意代码存在数据库里，反射型 XSS 的恶意代码存在 URL 里。</li> <li>DOM 型 XSS 跟前两种 XSS 的区别：DOM 型 XSS 攻击中，取出和执行恶意代码由浏览器端完成，属于前端 JavaScript 自身的安全漏洞，而其他两种 XSS 都属于服务端的安全漏洞。</li> <li>防范
<ul><li>设置 HttpOnly ：禁止 JS 读取<code>document.cookie</code>，解决 XSS 后的 Cookie 劫持攻击。</li> <li>输入过滤：检查用户输入的数据，过滤非法值或者编码再存入服务器（style 节点，script 节点，iframe 节点），可用开源的一些 XSS Filter。</li> <li>输出转码：输出到 HTML 页面时，潜在威胁的字符<code>&amp; &lt; &gt; &quot; ' /</code>进行 HTMLEncode 编码、转义</li> <li>限定输入内容的长度：增加 XSS 攻击难度</li> <li>DOM 型：避免拼接字符串传入一些 API，导致代码执行。不要把不可信的数据作为 HTML 插到页面上，例如不使用 v-html。</li></ul></li></ul> <h3 id="csrf-xsrf-跨站请求伪造"><a href="#csrf-xsrf-跨站请求伪造" class="header-anchor">#</a> CSRF/XSRF: 跨站请求伪造</h3> <ul><li>如何攻击：攻击者通过访问第三方黑客网站，通过 get 方式(图片链接 src)、post 方式(自动提交的表单)发送跨站请求，利用凭证 cookie，请求用户已登录的网站接口，执行恶意操作（只借用 cookie，不能获取）</li> <li>防范 1：阻止不明外域的访问
<ul><li><code>Samesite=Strict</code>: Set-Cookie 时将同站 cookie 属性设为严格模式，表明这个 Cookie 在任何情况下都不能作为第三方 Cookie。比如，在极客时间的⻚⾯中访问 InfoQ 的资源，⽽ InfoQ 的某些 Cookie 设置了 SameSite = Strict 的话，那么这些 Cookie 是不会被发送到 InfoQ 的服务器上的。只有你从 InfoQ 的站点去请求 InfoQ 的资源时，才会带上这些 Cookie。</li> <li>同源检测：请求 header 里的<code>Origin</code>和 <code>Referer</code> 字段，服务器判断发起请求的来源地址，校验是否合法。Origin 和 Referer 的区别就是 Origin 只包含域名信息，而 Referer 包含域名+路径信息</li></ul></li> <li>防范 2：提交时要求附加本域才能获取的信息
<ul><li>服务器生成 CSRF token（常用）：服务器根据用户信息 哈希算法生成 token 字符串 发给前端，前端存储在 localStorage 中，再次请求时前端请求头带上 token，服务端验证 token 是否正确（请求头可通过拦截器在接口调用时添加 token），一次性有效 token，每次接口校验完返回新 token。</li> <li>双重提交 Cookie：用户访问后，返回一个随机字符串注入 cookie，下次请求时取出，添加到 URL 参数上，验证与 cookie 是否一致。</li> <li>输入验证码：明确当前是本人操作的，用户体验差。</li></ul></li></ul> <h3 id="使用沙箱安全的执行用户-js-代码"><a href="#使用沙箱安全的执行用户-js-代码" class="header-anchor">#</a> 使用沙箱安全的执行用户 js 代码</h3> <ul><li>eval 和 new Function 这两个方法会在当前的 Context 中运行，它们可以访问 cookie 等隐私数据，所以不能使用这两个方法：</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> cookie <span class="token operator">=</span> <span class="token function">eval</span><span class="token punctuation">(</span><span class="token string">&quot;document.cookie&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> getCookie <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Function</span><span class="token punctuation">(</span><span class="token string">&quot;return document.cookie&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>所以，我们要将用户脚本放到<strong>沙箱（Sandbox）中去运行</strong>，同时不能让它们访问任何用户数据，比如 cookie、localStorage、JavaScript 全局变量、DOM 元素等。</li></ul> <h3 id="网络劫持"><a href="#网络劫持" class="header-anchor">#</a> 网络劫持</h3> <ul><li>http 劫持（明文修改响应，加广告）：全站 HTTPS，将 HTTP 加密，这使得运营商无法获取明文，就无法劫持你的响应内容</li></ul> <h3 id="json-劫持-json-hijacking"><a href="#json-劫持-json-hijacking" class="header-anchor">#</a> JSON 劫持(JSON Hijacking)</h3> <ul><li>属于 CSRF 范畴</li> <li>通过已认证过的凭证，构造 jsonp 执行跨域请求，获取数据执行回调，将数据通过 new Image 的方式发送到攻击者的服务器上。造成信息泄露。</li> <li>防御：
<ul><li>API 设置为 post，因为 jsonp 只能 get</li> <li>检查请求头表示有 ajax 发起的请求<code>X-Requested-With:XMLHttpRequest</code></li> <li>请求的参数加上与后端约定好的签名（带上时间戳）</li></ul></li></ul></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/pages/folder1/browser.html" class="prev">
        HTTP与浏览器
      </a></span> <span class="next"><a href="/pages/folder1/monitor.html">
        监控体系
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.d50c72b0.js" defer></script><script src="/assets/js/2.7285e602.js" defer></script><script src="/assets/js/32.0acbefde.js" defer></script>
  </body>
</html>
