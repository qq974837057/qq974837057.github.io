<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>概要总结 | 元气Blog</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/wind.png">
    <meta name="description" content="元气Joe的前端世界">
    
    <link rel="preload" href="/assets/css/0.styles.8a46e3d7.css" as="style"><link rel="preload" href="/assets/js/app.d50c72b0.js" as="script"><link rel="preload" href="/assets/js/2.7285e602.js" as="script"><link rel="preload" href="/assets/js/7.7f87f0fb.js" as="script"><link rel="prefetch" href="/assets/js/10.95e645d2.js"><link rel="prefetch" href="/assets/js/11.7a5bbaab.js"><link rel="prefetch" href="/assets/js/12.0bd756fe.js"><link rel="prefetch" href="/assets/js/13.c032609a.js"><link rel="prefetch" href="/assets/js/14.621e82f0.js"><link rel="prefetch" href="/assets/js/15.2bc7bb03.js"><link rel="prefetch" href="/assets/js/16.7b7424df.js"><link rel="prefetch" href="/assets/js/17.9a2f808e.js"><link rel="prefetch" href="/assets/js/18.2bb036cb.js"><link rel="prefetch" href="/assets/js/19.d8537971.js"><link rel="prefetch" href="/assets/js/20.c8e9e8fe.js"><link rel="prefetch" href="/assets/js/21.efec8fa1.js"><link rel="prefetch" href="/assets/js/22.3385e6bf.js"><link rel="prefetch" href="/assets/js/23.a260f1cf.js"><link rel="prefetch" href="/assets/js/24.69037aca.js"><link rel="prefetch" href="/assets/js/25.ebc4667f.js"><link rel="prefetch" href="/assets/js/26.d355b386.js"><link rel="prefetch" href="/assets/js/27.8c327e12.js"><link rel="prefetch" href="/assets/js/28.98128502.js"><link rel="prefetch" href="/assets/js/29.b35b9692.js"><link rel="prefetch" href="/assets/js/3.efa71162.js"><link rel="prefetch" href="/assets/js/30.d28a8fd7.js"><link rel="prefetch" href="/assets/js/31.2eab1cab.js"><link rel="prefetch" href="/assets/js/32.0acbefde.js"><link rel="prefetch" href="/assets/js/33.35108fd8.js"><link rel="prefetch" href="/assets/js/34.bd1353df.js"><link rel="prefetch" href="/assets/js/4.2ab80d3e.js"><link rel="prefetch" href="/assets/js/5.b6c9c262.js"><link rel="prefetch" href="/assets/js/6.d1cbcbdc.js"><link rel="prefetch" href="/assets/js/8.97df5136.js"><link rel="prefetch" href="/assets/js/9.80311f25.js">
    <link rel="stylesheet" href="/assets/css/0.styles.8a46e3d7.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/wind.png" alt="元气Blog" class="logo"> <span class="site-name can-hide">元气Blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="分类" class="dropdown-title"><span class="title">分类</span> <span class="arrow down"></span></button> <button type="button" aria-label="分类" class="mobile-dropdown-title"><span class="title">分类</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/folder1/html.html" class="nav-link">
  文章
</a></li><li class="dropdown-item"><!----> <a href="/pages/folder2/test4.html" class="nav-link">
  随笔
</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/qq974837057" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="分类" class="dropdown-title"><span class="title">分类</span> <span class="arrow down"></span></button> <button type="button" aria-label="分类" class="mobile-dropdown-title"><span class="title">分类</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/folder1/html.html" class="nav-link">
  文章
</a></li><li class="dropdown-item"><!----> <a href="/pages/folder2/test4.html" class="nav-link">
  随笔
</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/qq974837057" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>前端基础</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/folder1/html.html" class="sidebar-link">HTML</a></li><li><a href="/pages/folder1/css.html" class="sidebar-link">CSS</a></li><li><a href="/pages/folder1/js.html" class="sidebar-link">JS</a></li><li><a href="/pages/folder1/ts.html" class="sidebar-link">TS</a></li><li><a href="/pages/folder1/browser.html" class="sidebar-link">HTTP与浏览器</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>前端进阶</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/folder1/security.html" class="sidebar-link">前端安全</a></li><li><a href="/pages/folder1/monitor.html" class="sidebar-link">监控体系</a></li><li><a href="/pages/folder1/performance.html" aria-current="page" class="active sidebar-link">性能优化</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/folder1/performance.html#概要总结" class="sidebar-link">概要总结</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/folder1/performance.html#加载时" class="sidebar-link">加载时</a></li><li class="sidebar-sub-header"><a href="/pages/folder1/performance.html#运行时" class="sidebar-link">运行时</a></li><li class="sidebar-sub-header"><a href="/pages/folder1/performance.html#指标" class="sidebar-link">指标</a></li><li class="sidebar-sub-header"><a href="/pages/folder1/performance.html#分析" class="sidebar-link">分析</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/folder1/performance.html#概述" class="sidebar-link">概述</a></li><li class="sidebar-sub-header"><a href="/pages/folder1/performance.html#性能指标" class="sidebar-link">性能指标</a></li><li class="sidebar-sub-header"><a href="/pages/folder1/performance.html#客户端渲染-服务端渲染-预渲染" class="sidebar-link">客户端渲染&amp;服务端渲染&amp;预渲染</a></li><li class="sidebar-sub-header"><a href="/pages/folder1/performance.html#加载时-2" class="sidebar-link">加载时</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/folder1/performance.html#首屏加载" class="sidebar-link">首屏加载</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/folder1/performance.html#运行时-2" class="sidebar-link">运行时</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/folder1/performance.html#渲染原理介绍" class="sidebar-link">渲染原理介绍</a></li><li class="sidebar-sub-header"><a href="/pages/folder1/performance.html#提升动画性能" class="sidebar-link">提升动画性能</a></li><li class="sidebar-sub-header"><a href="/pages/folder1/performance.html#减少回流重绘" class="sidebar-link">减少回流重绘</a></li><li class="sidebar-sub-header"><a href="/pages/folder1/performance.html#减少内存泄漏" class="sidebar-link">减少内存泄漏</a></li><li class="sidebar-sub-header"><a href="/pages/folder1/performance.html#减少长时间任务" class="sidebar-link">减少长时间任务</a></li><li class="sidebar-sub-header"><a href="/pages/folder1/performance.html#节流防抖【参考-js-章节】" class="sidebar-link">节流防抖【参考 JS 章节】</a></li><li class="sidebar-sub-header"><a href="/pages/folder1/performance.html#大数据长列表性能" class="sidebar-link">大数据长列表性能</a></li><li class="sidebar-sub-header"><a href="/pages/folder1/performance.html#web-worker-多线程" class="sidebar-link">Web Worker 多线程</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/folder1/performance.html#vue-项目优化" class="sidebar-link">Vue 项目优化</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/folder1/performance.html#加载时-3" class="sidebar-link">加载时</a></li><li class="sidebar-sub-header"><a href="/pages/folder1/performance.html#运行时-3" class="sidebar-link">运行时</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/folder1/performance.html#h5-的优化" class="sidebar-link">H5 的优化</a></li></ul></li><li><a href="/pages/folder1/design-pattern.html" class="sidebar-link">设计模式和架构</a></li><li><a href="/pages/folder1/refactor.html" class="sidebar-link">代码重构之道</a></li><li><a href="/pages/folder1/nodejs.html" class="sidebar-link">node与前沿</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>前端框架</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/folder1/frame-common.html" class="sidebar-link">框架通识</a></li><li><a href="/pages/folder1/frame.html" class="sidebar-link">框架-Vue</a></li><li><a href="/pages/folder1/react.html" class="sidebar-link">框架-React</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>工程化和协作</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/folder1/webpack.html" class="sidebar-link">Webpack</a></li><li><a href="/pages/folder1/normalize.html" class="sidebar-link">前端规范</a></li><li><a href="/pages/folder1/git.html" class="sidebar-link">Git</a></li><li><a href="/pages/folder1/build.html" class="sidebar-link">构建</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>算法与编程</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/folder1/algorithm-data.html" class="sidebar-link">数据结构和算法-概念</a></li><li><a href="/pages/folder1/algorithm-sort.html" class="sidebar-link">数据结构和算法-排序专题</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="概要总结"><a href="#概要总结" class="header-anchor">#</a> 概要总结</h2> <h3 id="加载时"><a href="#加载时" class="header-anchor">#</a> 加载时</h3> <ul><li>网络和缓存策略
<ul><li>HTTP2 二进制分帧、多路复用、头部压缩、服务器推送</li> <li>SplitChunksPlugin 拆包配置+缓存策略（不常变动的设置较长缓存时间，第三方大模块单独打包，更新频率高的集中打包）</li> <li>CDN 配置</li></ul></li> <li>减少体积
<ul><li>Tree-Shaking（module：false、sideEffect：false）</li> <li>gzip 压缩（nginx 设置压缩比，也可前端使用插件 compression-webpack-plugin）</li></ul></li> <li>懒加载
<ul><li>图片懒加载(getBoundingClientRect 检测位置)</li> <li>路由懒加载</li></ul></li> <li>图片优化
<ul><li>小 icon 使用 url-loader 转为 base64</li> <li>适当选择 jpg、png、svg</li> <li>响应式图片倍数</li></ul></li></ul> <h3 id="运行时"><a href="#运行时" class="header-anchor">#</a> 运行时</h3> <ul><li>减少回流重绘
<ul><li>集中改变样式</li> <li>离线操作 DOM</li> <li>提升为合成层</li></ul></li> <li>减少内存泄漏
<ul><li>定时器及时销毁</li> <li>事件监听正确销毁</li> <li>DOM 引用使用 WeakMap 保存</li></ul></li> <li>防抖节流
<ul><li>防抖：按钮提交、输入请求</li> <li>节流：滚动监听、动画场景</li></ul></li> <li>大数据
<ul><li>虚拟列表</li> <li>时间切片</li> <li>分页 loading</li> <li>Web worker</li> <li>diff 优化：加 key</li></ul></li></ul> <h3 id="指标"><a href="#指标" class="header-anchor">#</a> 指标</h3> <ul><li>FP 首次绘制</li> <li>FCP 首次内容绘制</li> <li>TTI 可交互时间</li> <li>FPS 帧率</li></ul> <h3 id="分析"><a href="#分析" class="header-anchor">#</a> 分析</h3> <ul><li>Chrome DevTools - Lighthouse 面板：性能评分、SEO、FCP、TTI</li> <li>Chrome DevTools - Performance 面板
<ul><li>Timings：FP、FCP</li> <li>Main：函数调用栈和执行时间块</li> <li>Frames：帧率</li></ul></li> <li>API：window.performance.timing
<ul><li>navigationStart 按下回车瞬间</li> <li>domInteractive DOM 开始解析（白屏时间）</li> <li>domContentLoadedEventEnd DOM 解析完成（首屏加载时间）</li></ul></li></ul> <h2 id="概述"><a href="#概述" class="header-anchor">#</a> 概述</h2> <ul><li><p>前端应用最影响性能的是加载速度，直接影响用户体验。</p></li> <li><p>大部分页面需要 2 秒内完成加载，超过 3 秒，接近 40%的用户离开网站。</p></li> <li><p>所以优化方向就是让用户觉得加载得快！不仅包括加载指标速度的提升，还包括提高用户的体验，如有趣的 loading 或顺畅的骨架屏会让用户感觉并没有等太久。</p></li> <li><p>性能优化方案步骤</p> <ul><li>1.分析目前性能缺陷，确定性能提升目标</li> <li>2.针对特定场景，做对应方案，如加载时(首屏)，运行时(动画、内存泄漏、长列表)</li> <li>3.实施方案，查看优化效果</li></ul></li></ul> <h2 id="性能指标"><a href="#性能指标" class="header-anchor">#</a> 性能指标</h2> <ul><li><p><a href="https://zhuanlan.zhihu.com/p/82981365" target="_blank" rel="noopener noreferrer">知乎参考<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li> <li><p>指标概念</p> <ul><li>是否发生？FP(首次绘制) - 屏幕首次有视觉变化的时间点</li> <li>是否发生？FCP(首次内容绘制) - 浏览器第一次向屏幕绘制内容(文本、图片...)</li> <li>是否有用？FMP(首次有意义绘制) - 页面主要内容出现在屏幕上的时间</li> <li>是否可用？TTI(可交互时间) - 已渲染完毕，可以响应用户的操作</li> <li>FPS(每秒帧率) - 每秒钟画面更新次数，大部分屏幕为 60 次/秒</li></ul></li> <li><p>统计方式</p> <ul><li>整体
<ul><li>通过 Performance 工具可以用来录制一段时间的 CPU 占用、内存占用、FPS 等运行时性能问题，如 Bottom Up 看出一段时间较耗时的操作。</li> <li>通过 Network 工具或者代码统计页面的加载时间来分析加载性能问题。</li></ul></li> <li>手动查看分析：<strong>Chrome DevTools - Performance</strong> 面板
<ul><li>Timings:查看 FP、FCP、FMP</li> <li>CPU:通过下方的 summary 查看占用比例
<ul><li>Loading: 网络通信和 HTML 解析</li> <li>Scripting: JS 执行</li> <li>Rendering: 样式计算和布局</li> <li>Painting: 重绘</li> <li>System: 其它事件花费的时间</li> <li>Idle: 空闲时间</li> <li>Total: 总耗时</li></ul></li> <li>Main：倒置火焰图，横坐标表示消耗时间，纵坐标为函数调用栈，最上层是父级函数，最下方是调用栈最顶端的函数，可关注哪个函数占据宽度最大，平顶可能表示函数有性能问题。除了函数的耗时，还有 Recalculate Style：样式计算。Layout：布局位置。</li> <li>Frames:FPS 帧率，水平线越低且持续时间长，同时上方会出现红色线条，代表画面卡顿。</li> <li>Rendering：勾选 FPS，可查看帧率和 GPU 内存使用情况
<img src="/assets/img/chrome-devtools-1.7460d001.png" alt=""></li></ul></li> <li>代码：使用 API<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/PerformanceTiming" target="_blank" rel="noopener noreferrer">window.performance.timing<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，时间戳单位都是毫秒。
<img src="/assets/img/Per-timingAPI-1.197f954c.jpg" alt="timing API1"> <img src="/assets/img/Per-API.61d5a731.jpg" alt="timing API2"> <ul><li>起始点可选择：navigationStart(在 URL 输入栏回车或者页面按 F5 刷新的时间点) vs fetchStart(准备用 HTTP 请求获取文档的时间，除去重定向)</li> <li>白屏时间：从用户再按下回车的瞬间 navigationStart 到 解析器完成工作 domInteractive(即能看到第一个内容)</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> t <span class="token operator">=</span> window<span class="token punctuation">.</span>performance<span class="token punctuation">.</span>timing<span class="token punctuation">;</span>
<span class="token keyword">let</span> blankTime <span class="token operator">=</span> t<span class="token punctuation">.</span>domInteractive <span class="token operator">-</span> t<span class="token punctuation">.</span>navigationStart<span class="token punctuation">;</span> <span class="token comment">// 白屏时间</span>
<span class="token keyword">let</span> firstTime <span class="token operator">=</span> t<span class="token punctuation">.</span>domContentLoadedEventEnd <span class="token operator">-</span> t<span class="token punctuation">.</span>navigationStart<span class="token punctuation">;</span> <span class="token comment">// 首屏加载时间</span>
<span class="token keyword">let</span> tcpTime <span class="token operator">=</span> t<span class="token punctuation">.</span>connectEnd <span class="token operator">-</span> t<span class="token punctuation">.</span>connectStart<span class="token punctuation">;</span> <span class="token comment">// tcp连接耗时</span>
<span class="token keyword">let</span> dnsTime <span class="token operator">=</span> t<span class="token punctuation">.</span>domainLookupEnd <span class="token operator">-</span> t<span class="token punctuation">.</span>domainLookupStart<span class="token punctuation">;</span> <span class="token comment">// dns查询耗时</span>
</code></pre></div></li> <li>Lighthouse 网站性能测评工具
<ul><li>运行后会根据实际情况给出对应的评分和建议</li> <li>有 Performance 页面性能、PWA（渐进式 Web 应用）、Accessibility 可访问性（无障碍）、Best Practices 最佳实践、SEO 的评分</li> <li>有 FCP 等时间
<img src="/assets/img/performance-lighthouse.9d4e99dc.png" alt="Lighthouse"></li></ul></li></ul></li> <li><p>数据上传</p> <ul><li><code>navigator.sendBeacon(url, data);</code>通过 HTTP 将少量数据<strong>异步传输</strong>到 Web 服务器(不支持 IE)</li> <li>同步的缺点：导致卸载延时。统计和诊断代码通常要在 unload 或者 beforeunload 事件处理器中发起一个同步 XMLHttpRequest 来发送数据。同步的 XMLHttpRequest 迫使用户代理延迟卸载文档，并使得下一个导航出现的更晚。</li> <li>异步 sendBeacon 的优点：不会导致延迟。使用 sendBeacon() 方法会使用户代理在有机会时异步地向服务器发送数据，同时不会延迟页面的卸载或影响下一导航的载入性能。这就解决了提交分析数据时的所有的问题：数据可靠，传输异步并且<strong>不会影响下一页面的加载</strong>。</li></ul> <div class="language-js extra-class"><pre class="language-js"><code>window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;unload&quot;</span><span class="token punctuation">,</span> logData<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">logData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  navigator<span class="token punctuation">.</span><span class="token function">sendBeacon</span><span class="token punctuation">(</span><span class="token string">&quot;/log&quot;</span><span class="token punctuation">,</span> analyticsData<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>或者使用<code>new Image()</code>方式自动 get 请求，进行降级上报。</li></ul></li> <li><p>注意：</p> <ul><li><p>白屏时间可以通过 FP、FCP 来粗略代替，精确则使用<code>window.performance.timing</code>。</p></li> <li><p>SPA 通过<code>window.performance.timing</code>，只是首次加载的数据。改变 URL 实际不刷新页面，该 API 是无法获取子路由对应的页面相关时间。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// FP</span>
<span class="token keyword">function</span> <span class="token function">getFPTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> timings <span class="token operator">=</span> performance<span class="token punctuation">.</span><span class="token function">getEntriesByType</span><span class="token punctuation">(</span><span class="token string">&quot;paint&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> timings <span class="token operator">?</span> Math<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span>timings<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>startTime<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// FCP</span>
<span class="token keyword">function</span> <span class="token function">getFCPTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> timings <span class="token operator">=</span> performance<span class="token punctuation">.</span><span class="token function">getEntriesByType</span><span class="token punctuation">(</span><span class="token string">&quot;paint&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> timings<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">1</span> <span class="token operator">?</span> Math<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span>timings<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>startTime<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// FMP 尚无标准化的定义</span>

<span class="token comment">// TTI 谷歌npm包 - tti-polyfill</span>

<span class="token comment">// FPS</span>
<span class="token comment">// 不掉帧的情况，requestAnimationFrame 这个方法在一秒内会执行 60 次。</span>
<span class="token comment">// 假设动画在时间 A 开始执行，在时间 B 结束，耗时 x ms。</span>
<span class="token comment">// 而中间 requestAnimationFrame 一共执行了 n 次，则此段动画的帧率大致为：n / (B - A)。</span>

<span class="token comment">// 设备信息</span>
window<span class="token punctuation">.</span>navigator<span class="token punctuation">.</span>userAgent<span class="token punctuation">;</span> <span class="token comment">// 获取用户设备信息</span>
window<span class="token punctuation">.</span>navigator<span class="token punctuation">.</span>language<span class="token punctuation">;</span> <span class="token comment">// 获取用户设备语言</span>
window<span class="token punctuation">.</span>navigator<span class="token punctuation">.</span>connection<span class="token punctuation">;</span> <span class="token comment">// 获取设备网络信息</span>
window<span class="token punctuation">.</span>devicePixelRatio<span class="token punctuation">;</span> <span class="token comment">// 获取设备像素比</span>
</code></pre></div><p><img src="/assets/img/performance-fp-fcp.e5369d15.png" alt="fp-fcp"> <img src="data:image/png;base64,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" alt="用户设备信息"></p></li></ul></li> <li><p>注意：</p> <ul><li>FP 和 FCP 可能是相同的时间，也可能是先 FP 后 FCP</li> <li>帧率能够达到 50 ～ 60 FPS 的动画将会相当流畅，让人倍感舒适；帧率在 30 FPS 以下或者帧率波动很大的动画，让人感觉到明显的卡顿和不适感；</li></ul></li> <li><p>获取函数执行耗时</p> <ul><li>只能控制台调试用(不要在生产环境使用)
<ul><li><code>console.time('1');fn();console.timeEnd('1');</code></li></ul></li> <li>获取时间戳，然后相减。
<ul><li><code>Date.now();</code> 时间精度为 毫秒（10^-3）级别；</li> <li><code>new Date().getTime();</code></li> <li><code>+new Date();</code></li></ul></li> <li>更精确的方案
<ul><li>浏览器：<code>window.performance.now()</code>获取从<code>window.performance.timing.navigationStart</code>到当前时刻的毫秒数，带小数点。<code>performance.timing.navigationStart + performance.now()</code> 约等于 <code>Date.now()</code>。</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">doSomething</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">1000</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    i <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">let</span> t0 <span class="token operator">=</span> window<span class="token punctuation">.</span>performance<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">doSomething</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> t1 <span class="token operator">=</span> window<span class="token punctuation">.</span>performance<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;doSomething函数执行了&quot;</span> <span class="token operator">+</span> <span class="token punctuation">(</span>t1 <span class="token operator">-</span> t0<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;毫秒.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// doSomething函数执行了0.09499990846961737毫秒.</span>
</code></pre></div><ul><li>Node 环境：<code>process.hrtime.bigint()</code>，直接通过两个 bigint 相减来计算差异。在 Node.js 程序中，优先选 <code>process.hrtime</code>，其次选 <code>performance.now</code>，最后才会是 <code>Date.now</code>。</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> start <span class="token operator">=</span> process<span class="token punctuation">.</span>hrtime<span class="token punctuation">.</span><span class="token function">bigint</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 191051479007711n</span>
<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> end <span class="token operator">=</span> process<span class="token punctuation">.</span>hrtime<span class="token punctuation">.</span><span class="token function">bigint</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 191052633396993n</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">基准测试耗时 </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>end <span class="token operator">-</span> start<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> 纳秒</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 基准测试耗时 1154389282 纳秒</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li></ul></li> <li><p>打包后文件体积</p> <div class="language- extra-class"><pre class="language-text"><code>npm run build -- --report 查看打包后的大小
</code></pre></div><ul><li>主要是 vendors 依赖包文件 js 较大，和 app 主代码块较大，下面为某项目举例
<ul><li>stat 原始大小 2.7mb</li> <li>parsed 压缩插件处理后 1.08mb (40%)</li> <li>gzip 压缩后 300kb (10%)</li></ul></li></ul></li></ul> <h2 id="客户端渲染-服务端渲染-预渲染"><a href="#客户端渲染-服务端渲染-预渲染" class="header-anchor">#</a> 客户端渲染&amp;服务端渲染&amp;预渲染</h2> <ul><li><p>客户端渲染：用户访问 url，请求 html 文件，前端在浏览器跑一遍 JS，生成 DOM，渲染页面。关键链路较长，有一定的白屏时间；</p></li> <li><p>服务端渲染：用户访问 url，服务端根据访问路径请求所需数据，拼接成 html 字符串，将响应返回给前端。前端接收到 html 时已有内容；</p></li> <li><p>预渲染：构建阶段生成匹配预渲染路径的 html 文件（注意：每个需要预渲染的路由都有一个对应的 html）。构建出来的 html 文件已有部分内容。不适合个性化、经常变化的内容使用预渲染。
<img src="/assets/img/Per-SSR&amp;Prerender.a140bc11.png" alt="客户端渲染&amp;服务端渲染&amp;预渲染"></p></li> <li><p>客户端渲染(CSR)</p> <ul><li>特点：需要跑 JS 生成 DOM，HTML 初始时没具体内容</li> <li>优点：客户端体验好</li> <li>缺点：首屏加载慢，不利于 seo(抓取不到通过 Ajax 获取到的内容)</li></ul></li> <li><p>服务端渲染(SSR)</p> <ul><li>特点：不需要跑 JS，响应已经返回有内容的 HTML</li> <li>优点
<ul><li>更好的 SEO：数据已包含在页面，无须异步 Ajax 获取内容，方便爬虫抓取。</li> <li>首屏加载更快：直接渲染好后返回，无须再下载 js 再渲染。</li></ul></li> <li>缺点
<ul><li>服务器负载压力大：用户过多，将原本属于服务器的渲染压力分到服务器上，负载太大。</li> <li>开发条件限制：只支持 beforeCreate 和 created 两个钩子函数，一些外部扩展库需要特殊处理。且服务器需要处于 Node.js 运行环境。</li></ul></li> <li>原理
<ul><li>将框架的实例转为字符串</li> <li>将字符串塞入模板里，返回响应给用户</li></ul></li></ul></li></ul> <h2 id="加载时-2"><a href="#加载时-2" class="header-anchor">#</a> 加载时</h2> <blockquote><p>加载时可以以首屏加载速度来做优化</p></blockquote> <ul><li><a href="https://zhuanlan.zhihu.com/p/37148975" target="_blank" rel="noopener noreferrer">参考<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <h3 id="首屏加载"><a href="#首屏加载" class="header-anchor">#</a> 首屏加载</h3> <blockquote><p>首屏的加载速度很重要,过长的白屏会导致用户流失。
WEEX 生成的是 JS 渲染成原生组件，此部分不适用</p></blockquote> <ul><li><p>用户体验感知</p> <ul><li>前置简单 loading：插件 html-webpack-plugin，将 loading 提前到白屏时展示(首屏体积 = html + css)，不需要等 JS 加载，写好 loading 的 html 和 css，在 html 中使用模板插入对应的 loading 变量到根节点。</li></ul> <div class="language-html extra-class"><pre class="language-html"><code><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    &lt;%= htmlWebpackPlugin.options.loading.css %&gt;
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>

  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>root<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>&lt;%= htmlWebpackPlugin.options.loading.html %&gt;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><ul><li>骨架屏占位：插件<strong>vue-server-renderer</strong>，展示大体结构，视觉过渡流畅。
<ul><li>将 vue 文件转为 html 和 css 字符串，骨架屏的样式通过<code>&lt;style&gt;&lt;/style&gt;</code>标签直接被插入，而骨架屏的内容也被放置在<code>div#app</code>之间</li></ul></li></ul></li> <li><p>网络和缓存</p> <ul><li>HTTP2：二进制分帧、多路复用、头部压缩、服务端推送</li> <li>CDN 缓存提高资源加载速度</li> <li>拆包 + 缓存策略：webpack 4.x 对 SplitChunksPlugin 插件进行拆包配置 + 强制缓存和协商缓存，将第三方库分别拆开设置较长的强缓存时间并加上 hash
<ul><li>如基础型的 react 等库与工具性的 lodash 和特定库 Echarts 进行拆分</li></ul></li> <li>组件的缓存 keep-alive
<ul><li>在页面已经跳转后依然不销毁组件,保存组件的实例在内存中,再次渲染时可以利用缓存的组件实例。</li> <li>大量实例不销毁,保存在内存中,存在内存泄漏的风险,要调用 deactivated 销毁。</li></ul></li></ul></li> <li><p>懒加载</p> <ul><li>图片懒加载（vue-lazyload）原理：进入可视区域再加载图片
<ul><li>使用：src 换成 v-lazy</li></ul> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">v-lazy</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/static/img/1.png<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
</code></pre></div></li> <li>路由懒加载（不同路由组件分割代码块 chunk，访问该路由才加载对应 js）结合 Vue 的异步组件和 Webpack 的代码分割(Code Splitting)功能<div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">Foo</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">&quot;./Foo.vue&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">VueRouter</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  routes<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> path<span class="token operator">:</span> <span class="token string">&quot;/foo&quot;</span><span class="token punctuation">,</span> component<span class="token operator">:</span> Foo <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li> <li>组件级别懒加载
<ul><li>思路：IntersectionObserver 条件判断是否出现在屏幕(图片懒加载也使用过此 API) + v-if 指令渲染组件 + 骨架屏触发屏幕条件判断(大体灰白结构)</li></ul></li></ul></li> <li><p>减少体积</p> <ul><li><p>Tree Shaking：webpack4.x 默认支持，基于 ES6 的 modules，要设置 modules: false 避免转为 commonjs 规范。</p></li> <li><p>gzip 压缩：效果 Content-Encoding：gizp，文件大小降为 30%。服务器 nginx 设置压缩比等 或者 前端安装 compression-webpack-plugin，再配置 productionGzip，构建时生成.gz 文件，服务器就无须再压缩。一般图片不压缩。</p> <ul><li>nginx</li></ul> <div class="language- extra-class"><pre class="language-text"><code>// nginx的配置方式
http {
  gzip on;
  gzip_static on;
  gzip_min_length 1024;
  gzip_buffers 4 16k;
  gzip_comp_level 2;
  gzip_types text/plain application/javascript application/x-javascript text/css application/xml text/javascript application/x-httpd-php application/vnd.ms-fontobject font/ttf font/opentype font/x-woff image/svg+xml;
  gzip_vary off;
  gzip_disable &quot;MSIE [1-6]\.&quot;;
}
</code></pre></div><ul><li>前端：config/index.js 里有一个 productionGzip 设置为 true，前端进行 gzip 压缩生成.gz 文件。nginx 的 gzip_static 设为 on，就直接使用同名.gz 文件，不用占用服务器 CPU 资源自己压缩。</li> <li>express：</li></ul> <div class="language- extra-class"><pre class="language-text"><code>npm i express compression

// serve.js
var express = require('express')
var app = express()

// 开启gzip压缩,如果你想关闭gzip,注释掉下面两行代码，重新执行`node server.js`
var compression = require('compression')
app.use(compression())

app.use(express.static('dist'))
app.listen(3000,function () {
  console.log('server is runing on http://localhost:3000')
})

node server.js
</code></pre></div></li> <li><p>CDN：剥离第三方库依赖（vue、element-ui）放在 cdn 如 jsDelivr，在 html 中通过 script 引入，不会被打包到代码文件 vendor.js 中，减少包的体积，降低自己服务器压力，CDN 提升依赖加载速度。【如 vue、vue-router、vuex、element-ui 和 axios】，使用 CDN 后卸载对应 npm 包【npm uninstall ...】</p> <ul><li>将依赖的 vue、vue-router、vuex、element-ui 和 axios 这五个库，改为通过 CDN 链接获取。借助 HtmlWebpackPlugin,可以方便的使用循环语法在 index.html 里插入 js 和 css 的 CDN 链接。</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> <span class="token constant">CDN</span>文件，配置在config<span class="token operator">/</span>index<span class="token punctuation">.</span>js下 <span class="token operator">--</span><span class="token operator">&gt;</span>
<span class="token comment">// config/index.js</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  build<span class="token operator">:</span> <span class="token punctuation">{</span>
    cdn<span class="token operator">:</span> <span class="token punctuation">{</span>
      css<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token string">&quot;https://unpkg.com/element-ui/lib/theme-chalk/index.css&quot;</span><span class="token punctuation">,</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
      js<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token string">&quot;https://cdn.jsdelivr.net/npm/vue@2.5.17/dist/vue.min.js&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;https://cdn.jsdelivr.net/npm/vue-router@3.0.1/dist/vue-router.min.js&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;https://cdn.jsdelivr.net/npm/vuex@3.0.1/dist/vuex.min.js&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;https://unpkg.com/element-ui/lib/index.js&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;https://cdn.jsdelivr.net/npm/axios@0.18.0/dist/axios.min.js&quot;</span>
      <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// build/webpack.prod.conf.js</span>

<span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span>
  <span class="token punctuation">{</span> <span class="token operator">...</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  config<span class="token punctuation">.</span>build<span class="token punctuation">.</span>cdn
<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</code></pre></div><div class="language-html extra-class"><pre class="language-html"><code>// index.html - 通过模板引入循环插入html
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
  &lt;% for (var i in htmlWebpackPlugin.options.css) { %&gt;
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>&lt;%= htmlWebpackPlugin.options.css[i] %&gt;<span class="token punctuation">&quot;</span></span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>stylesheet<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
  &lt;% } %&gt;
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
  &lt;% for (var i in htmlWebpackPlugin.options.js) { %&gt;
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>&lt;%= htmlWebpackPlugin.options.js[i] %&gt;<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
  &lt;% } %&gt;
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><ul><li>在 build/webpack.prod.conf.js 中添加如下代码,使用 CDN 引入外部文件的情况下，依然可以在项目中使用 import 的语法来引入这些第三方库，也就意味着你不需要改动项目的代码，这里的键名是 import 的 npm 包名，键值是该库暴露的全局变量。</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// build/webpack.prod.conf.js</span>
externals<span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token string">'vue'</span><span class="token operator">:</span> <span class="token string">'Vue'</span><span class="token punctuation">,</span>
  <span class="token string">'vue-router'</span><span class="token operator">:</span> <span class="token string">'VueRouter'</span><span class="token punctuation">,</span>
  <span class="token string">'vuex'</span><span class="token operator">:</span> <span class="token string">'Vuex'</span><span class="token punctuation">,</span>
  <span class="token string">'element-ui'</span><span class="token operator">:</span><span class="token string">'ELEMENT'</span><span class="token punctuation">,</span>
  <span class="token string">'axios'</span><span class="token operator">:</span><span class="token string">'axios'</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>动态加载 ES6 代码：ES6 意味着不用经过 Babel 转译，体积更小，性能更好，<code>&lt;script type=&quot;module&quot;&gt;</code>这个标签来判断浏览器是否支持 es6。</p></li></ul></li> <li><p>预渲染&amp;服务端渲染</p> <ul><li><p>预渲染：插件<strong>prerender-spa-plugin</strong>，预渲染静态 html 内容，构建过程中，在 dist 目录中开启一个静态服务器，使用无头浏览器（puppeteer）访问对应的路径，执行 JS，捕获内容并输出 html 文件，放在指定路由同名的文件夹，访问时返回对应的已渲染好的 index.html 文件，适合静态内容多的页面（不考虑动态数据的话）。</p> <ul><li>router 设为 history 模式，然后安装插件</li></ul> <div class="language- extra-class"><pre class="language-text"><code>npm i prerender-spa-plugin --save-dev

</code></pre></div><ul><li>添加配置，定义需要预渲染的路由</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//  build/webpack.prod.conf.js</span>
<span class="token keyword">const</span> PrerenderSPAPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'prerender-spa-plugin'</span><span class="token punctuation">)</span>
<span class="token operator">...</span>
<span class="token keyword">new</span> <span class="token class-name">PrerenderSPAPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  staticDir<span class="token operator">:</span> config<span class="token punctuation">.</span>build<span class="token punctuation">.</span>assetsRoot<span class="token punctuation">,</span>
  routes<span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token string">'/Contacts'</span> <span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// 需要预渲染的路由（视你的项目而定）</span>
  minify<span class="token operator">:</span> <span class="token punctuation">{</span>
    collapseBooleanAttributes<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    collapseWhitespace<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    decodeEntities<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    keepClosingSlash<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    sortAttributes<span class="token operator">:</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><ul><li>调整 main.js</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 激活静态HTML，使他们成为动态的，可根据后续数据变化调整。</span>
<span class="token comment">// 强制使用应用程序的激活模式</span>
<span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  router<span class="token punctuation">,</span>
  <span class="token function-variable function">render</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">h</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">h</span><span class="token punctuation">(</span>App<span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">$mount</span><span class="token punctuation">(</span><span class="token string">&quot;#app&quot;</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li> <li><p>SSR 服务端渲染(nuxt.js)</p></li></ul></li> <li><p>图片的几种优化方式</p> <ul><li>选择合适的格式：复杂和色彩层次丰富的用 jpg，线条和颜色简单如 logo 用 png，想要不失真可以用 svg，webp 兼容性不好，不推荐。</li> <li>小 icon 使用 base64，可直接将字符串解码为图片，不用发 HTTP 请求，webpack 的 url-loader 可以进行配置</li> <li>图片懒加载</li> <li>srcset 像素密度描述符对应几倍图<div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>joe_1x.png<span class="token punctuation">&quot;</span></span> <span class="token attr-name">srcset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>joe_2x.png 2x, joe_3x.png 3x<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
</code></pre></div></li></ul></li></ul> <h4 id="图片懒加载原理"><a href="#图片懒加载原理" class="header-anchor">#</a> 图片懒加载原理</h4> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>img-area<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>my-photo<span class="token punctuation">&quot;</span></span> <span class="token attr-name">alt</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>desc<span class="token punctuation">&quot;</span></span> <span class="token attr-name">data-src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>./img/img1.png<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>img-area<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>my-photo<span class="token punctuation">&quot;</span></span> <span class="token attr-name">alt</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>desc<span class="token punctuation">&quot;</span></span> <span class="token attr-name">data-src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>./img/img2.png<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><ul><li>原理：
<ul><li><code>&lt;img&gt;</code>标签的 src 属性先设置为空或者为默认图片的 url，这样图片为空或默认图片。</li> <li>再设置 data-src 为真实的 url，判断图片进入可视区域，通过 el.dataset 将真实 url 取出</li> <li>放入 src 属性中，浏览器发出请求，显示正常图片。</li></ul></li></ul> <blockquote><p>alt 属性是一个必需的属性，它规定在图像无法显示时的替代文本。</p></blockquote> <blockquote><p>data-* 全局属性：构成一类名称为自定义数据属性的属性，可以通过 HTMLElement.dataset 来访问。</p></blockquote> <ul><li><p>实现方法（2 种）：</p> <ul><li><p>getBoundingClientRect</p> <ul><li><p>获取元素大小和位置，针对视口左上角的坐标而言</p></li> <li><p>返回的对象包括 top、right、botton、left、width、height 属性</p></li> <li><p>判断图片已出现在屏幕中：el.getBoundingClientRect().top&lt;=window.clientHeight （图片到可视区域顶部的距离）&lt;=(可视区域的高度)</p></li> <li><p>加载方法是将 src 赋值为真实 url：el.src = el.dataset.src</p></li> <li><p>首次进入页面【window.onload】或者滚动条滚动【window.onscroll】时遍历所有图片，若出现在屏幕内，则加载。</p></li> <li><p>优化：滚动条滚动检查图片采取使用节流函数；滚动时只检查剩余的图片；</p></li></ul></li> <li><p>示例 1：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">isInSight</span><span class="token punctuation">(</span><span class="token parameter">el</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> bound <span class="token operator">=</span> el<span class="token punctuation">.</span><span class="token function">getBoundingClientRect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> clientHeight <span class="token operator">=</span> window<span class="token punctuation">.</span>innerHeight<span class="token punctuation">;</span>
  <span class="token comment">//如果只考虑向下滚动加载</span>
  <span class="token comment">//const clientWidth = window.innerWeight;</span>
  <span class="token keyword">return</span> bound<span class="token punctuation">.</span>top <span class="token operator">&lt;=</span> clientHeight <span class="token operator">+</span> <span class="token number">100</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">checkImgs</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> imgs <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">&quot;.my-photo&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  Array<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>imgs<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">el</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isInSight</span><span class="token punctuation">(</span>el<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">loadImg</span><span class="token punctuation">(</span>el<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">loadImg</span><span class="token punctuation">(</span><span class="token parameter">el</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>el<span class="token punctuation">.</span>src<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> source <span class="token operator">=</span> el<span class="token punctuation">.</span>dataset<span class="token punctuation">.</span>src<span class="token punctuation">;</span>
    el<span class="token punctuation">.</span>src <span class="token operator">=</span> source<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>IntersectionObserver</p> <ul><li>首次进入页面，通过新建 IntersectionObserver 对象 io 并传入 callback 函数，用 io.observe 方法监听每个图片 dom 节点，当比例大于 0 小于 1 时，执行加载图片，加载完毕 io.unobserve 关掉该图片 dom 节点的监听。</li> <li>callback 函数传入参数为数组，每个元素有自己的 target（dom 节点）和 intersectionRatio（在屏幕中出现比例）</li> <li>回调函数进行遍历每个元素执行下面操作
<ul><li>判断图片已出现在屏幕中:intersectionRatio &gt; 0 &amp;&amp; intersectionRatio &lt;= 1</li> <li>加载方法是将 src 赋值为真实 url：el.src = el.dataset.src</li> <li>el.onload 后关闭观察器 io.unobserve(el)。</li></ul></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> io <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IntersectionObserver</span><span class="token punctuation">(</span>callback<span class="token punctuation">,</span> option<span class="token punctuation">)</span><span class="token punctuation">;</span>
io<span class="token punctuation">.</span><span class="token function">observe</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;example&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 开始观察</span>
io<span class="token punctuation">.</span><span class="token function">unobserve</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 停止观察</span>
io<span class="token punctuation">.</span><span class="token function">disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 关闭观察器</span>
</code></pre></div><ul><li>兼容性
<ul><li>Chrome 51+（发布于 2016-05-25）</li> <li>Firefox 55</li> <li>iOS 12.2</li></ul></li></ul></li> <li><p>示例 2：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> io <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IntersectionObserver</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">ioes</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  ioes<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">ioe</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> el <span class="token operator">=</span> ioe<span class="token punctuation">.</span>target<span class="token punctuation">;</span>
    <span class="token keyword">const</span> intersectionRatio <span class="token operator">=</span> ioe<span class="token punctuation">.</span>intersectionRatio<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>intersectionRatio <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> intersectionRatio <span class="token operator">&lt;=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">loadImg</span><span class="token punctuation">(</span>el<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    el<span class="token punctuation">.</span>onload <span class="token operator">=</span> el<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> io<span class="token punctuation">.</span><span class="token function">unobserve</span><span class="token punctuation">(</span>el<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">checkImgs</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> imgs <span class="token operator">=</span> Array<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">&quot;.my-photo&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  imgs<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> io<span class="token punctuation">.</span><span class="token function">observe</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">loadImg</span><span class="token punctuation">(</span><span class="token parameter">el</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>el<span class="token punctuation">.</span>src<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> source <span class="token operator">=</span> el<span class="token punctuation">.</span>dataset<span class="token punctuation">.</span>src<span class="token punctuation">;</span>
    el<span class="token punctuation">.</span>src <span class="token operator">=</span> source<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ul></li></ul> <blockquote><p>注意：获取 dom 之后要将所有图片 dom 节点转为数组对象才能使用数组遍历方法：Array.from</p></blockquote> <h2 id="运行时-2"><a href="#运行时-2" class="header-anchor">#</a> 运行时</h2> <blockquote><p>高性能要求的场景，优化代码执行速度，主要分为动画优化、减少回流重绘、减少内存泄漏、长列表优化、多线程运行。</p></blockquote> <h3 id="渲染原理介绍"><a href="#渲染原理介绍" class="header-anchor">#</a> 渲染原理介绍</h3> <ul><li><p>展示总体步骤
<img src="data:image/jpeg;base64,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/wDN/wD/2gAMAwEAAgADAAAAEPNPPPPPPPPOMPPPPPOMvPPPPPOOMssssssMsssssssssPLM8MMMMMMMMP8ALLLLLIjrLLLLLLz333330L3333333335zwAM40w84U8JYoIYMsIEEM0UQkhD3vn3361bjHnXnX3T/wA8AT/bvT6tdCC2XFVACCRVeLjLjV+9K1N+5dtELc67KU/88ACCCCCCxCCRBCCzCCCyCCCCCDC++++++sc+++t++++/84BAAAAAAAAEWMNNNNNgNNNNNNOQ++++++a+++++++++o8888888888888888888888888888888888888888888888//8QAJBEAAgICAQQCAwEAAAAAAAAAAAERYSExECBBUaFQcYGx4cH/2gAIAQMBAT8Q+OfTTRQKBQKBQKBQKBWETJYZAgQIECAiTIECBAgQICpkLhcLhcLhcEt2VsvFwuFwuFwuFwuC4fL0eExtLsShqTbehhDEPIpTQ0aT1xMrv2GlcQ4TnhqUNjieZ4Q9Ma5hgG7Qnak0i4RK0xzW7GkJE2Q9wSIkTM2CIg97n0RmGksbPU2vvRDI3h/UinOxMmiceH+kOaxyHimOP9eRyzXjlhaDIcEZJcoPQ5a0Q8IkNNrh6GbEnVhpFpI2J8fpiGlLzHueEm3CHSad0sjDriSSycZEhJYz/DJqDhSxMbacZc2KDnwS1LxL/gtTR73Po9cKZ784tbYlHU0ISF1pa2MZt9Sk3qQ9zd+iXEdPvcvwnhFDKGUMoZQyhlDKGUMX4HYgQIECBAatkCBAgQIECEQtRai1FqLUWoi/yFqLUWotRai1FqLUWoS27fH/AP/EACoRAAIBAwMEAQQCAwAAAAAAAAABESExYUFxkRBRofEggbHR8MHhMEBQ/9oACAECAQE/EP8ASn/DJJJJJPSSSSSSSSSfg7gkm9T3x7498e+PfHvj3x7498Ob5Urmz/gwODA4MDgwODA4MDgivnRrtkwODA4MDgwODA4MDgpWcDDKP16MgyDIMgyDMFl1VcyDIMgyDIMgyDIMgRTbr5bowqpYQx2kl7CZJpajmvampWiB+bQUJpCdujZClnsJma6jaSlnmVU0JylMTbT6KaamEoxTmshBdRiRkqw2MhCcqULe4qvtr+Rrm0GkBsk1cmCcm4t0VojGNboRo01VEMhkDWSGgm10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" alt="performance-render1"></p> <ul><li>JS 实现动画或新增 DOM -&gt; Style 计算样式 -&gt; Layout 进行布局计算位置 -&gt; Paint 绘制 -&gt; Composite 渲染层合并</li></ul></li> <li><p>Composite 详细流程
<img src="/assets/img/performance-render.30ebd7d0.png" alt="performance-render"></p> <ul><li>Nodes 到 LayoutObjects(布局对象)
<ul><li>每个 Node 节点都有一个对应的 LayoutObject，保存样式位置信息，构成一个树。</li></ul></li> <li>LayoutObjects 到 PaintLayers(渲染层)
<ul><li>根据层叠上下文的位置创建新渲染层，也有特殊情况会创建新的渲染层。</li></ul></li> <li>PaintLayers 到 GraphicsLayers(图形层)
<ul><li>合成层拥有独立的图形层，其他渲染层公用一个图形层。每个图形层会生成位图，交给 GPU 将多个位图合成， 然后展现在屏幕上。</li></ul></li> <li>层压缩
<ul><li>大量合成层消耗内存，影响性能，所以浏览器会进行自动层压缩，但有些是压缩不了的。</li></ul></li></ul></li></ul> <h3 id="提升动画性能"><a href="#提升动画性能" class="header-anchor">#</a> 提升动画性能</h3> <ul><li><p>动画的三种实现方式</p> <ul><li>CSS3</li> <li>Canvas + JS</li> <li>DOM + JS (非常容易引起回流重绘，尽量避免)</li></ul></li> <li><p>CSS 动画优化</p> <ul><li><p>原则：</p> <ul><li>尽量将动画提升为一个独立图层(合成层)，避免动画效果导致重绘影响其他渲染层的元素</li> <li>尽量利用 GPU 硬件加速(提示为合成层也就会用到硬件加速啦)</li> <li>尽量避免回流和重绘，除了常规的避免，在合成层上使用 transform 和 opacity 也不会导致回流重绘。</li></ul></li> <li><p>提升为合成层的较好的两种方式：</p> <ul><li>CSS 的 will-change 属性。will-change 设置为 opacity、transform、top、left、bottom、right（其中 top、left 等需要设置明确的定位属性，如 relative 等）</li></ul> <div class="language-css extra-class"><pre class="language-css"><code><span class="token selector">#target</span> <span class="token punctuation">{</span>
  <span class="token property">will-change</span><span class="token punctuation">:</span> transform<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>如不支持，使用 3D transform 属性强制提升。</li></ul> <div class="language-css extra-class"><pre class="language-css"><code><span class="token selector">#target</span> <span class="token punctuation">{</span>
  <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">translateZ</span><span class="token punctuation">(</span>0<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>提升为合成层好处</p> <ul><li>合成层的位图会交给 GPU 合成，速度比 CPU 快</li> <li>需要重绘时，只重绘自身，不会影响其他层</li> <li>可以使用 transform 和 opacity 实现动画效果，不会引发回流重绘，在其他渲染层就会。</li></ul></li> <li><p>查看合成层</p> <ul><li>简单：DevTools，勾选上 Layer Borders</li> <li>详细：More Tools，添加 Layers 选项卡</li> <li>可关注 Composite 渲染层合并的时间来优化合成层的数量。
<img src="data:image/png;base64,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" alt="查看合成层"></li></ul></li> <li><p>硬件加速原理：</p> <ul><li>让容器有自己的单独的渲染层，由 GPU 直接处理完成样式或其他的处理。</li></ul></li> <li><p>硬件加速开启方式</p> <ul><li>will-change</li> <li>3D transform</li> <li>video 元素</li> <li>backface-visibility 为 hidden 的元素(翻转后背面不可见)</li> <li>...</li></ul></li> <li><p>硬件加速优缺点</p> <ul><li>建议：只在需要的情况下开启，不要滥用</li> <li>优点：提高渲染速度</li> <li>缺点：额外内存消耗，耗电量增加</li></ul></li></ul></li> <li><p>Canvas 动画优化</p> <ul><li>使用 requestAnimationFrame 替代 setInterval 来做动画循环</li> <li>使用 web worker 分担主线程压力，解决大量数据计算，大量 DOM 操作的卡顿问题</li></ul></li></ul> <h3 id="减少回流重绘"><a href="#减少回流重绘" class="header-anchor">#</a> 减少回流重绘</h3> <ul><li>重排（回流）：节点尺寸需要重新计算，重新排列元素，引起局部或整个页面重新渲染</li> <li>重绘：样式发生变化，更新外观内容</li> <li>重绘不一定出现重排</li> <li>重排一定会出现重绘</li></ul> <h4 id="如何触发"><a href="#如何触发" class="header-anchor">#</a> 如何触发</h4> <ul><li>改变 DOM 元素的几何属性：width、height、padding、margin、left、top、border</li> <li>获取即时性属性：offsetTop、offsetLeft、 offsetWidth、offsetHeight、scrollTop、scrollLeft、scrollWidth、scrollHeight、clientTop、clientLeft、clientWidth、clientHeight</li> <li>增加、删除、更新、移动 DOM 或者 动画</li> <li>display: none 隐藏一个 DOM 节点 -&gt; 回流和重绘</li> <li>visibility: hidden 隐藏一个 DOM 节点 -&gt; 重绘</li></ul> <h4 id="如何优化"><a href="#如何优化" class="header-anchor">#</a> 如何优化</h4> <ul><li>集中改变样式
<ul><li>改变 class（类名）的方式<div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 判断是否是黑色系样式</span>
<span class="token keyword">const</span> theme <span class="token operator">=</span> isDark <span class="token operator">?</span> <span class="token string">&quot;dark&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;light&quot;</span><span class="token punctuation">;</span>
<span class="token comment">// 根据判断来设置不同的class</span>
ele<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;className&quot;</span><span class="token punctuation">,</span> theme<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li></ul></li> <li>离线操作 DOM
<ul><li>DocumentFragment：createDocumentFragment 在 dom 树之外创建游离节点，该节点上批量操作，再插入 dom，一次重排<div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> fragment <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createDocumentFragment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> node <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;p&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  node<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> i<span class="token punctuation">;</span>
  fragment<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>fragment<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li> <li>display:none，从页面移除该元素，再操作完后添加回来<div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> container <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'container'</span><span class="token punctuation">)</span>
container<span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">'none'</span>
container<span class="token punctuation">.</span>style<span class="token punctuation">.</span>width <span class="token operator">=</span> <span class="token string">'100px'</span>
container<span class="token punctuation">.</span>style<span class="token punctuation">.</span>height <span class="token operator">=</span> <span class="token string">'200px'</span>
container<span class="token punctuation">.</span>style<span class="token punctuation">.</span>border <span class="token operator">=</span> <span class="token string">'10px solid red'</span>
container<span class="token punctuation">.</span>style<span class="token punctuation">.</span>color <span class="token operator">=</span> <span class="token string">'red'</span>
<span class="token operator">...</span>（省略了许多类似的后续操作）
container<span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">'block'</span>
</code></pre></div></li></ul></li> <li>提升至合成层
<ul><li>CSS 的 will-change<div class="language-css extra-class"><pre class="language-css"><code><span class="token selector">#target</span> <span class="token punctuation">{</span>
  <span class="token property">will-change</span><span class="token punctuation">:</span> transform<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li>重绘时只会影响合成层，不会影响其它层</li> <li>transform 和 opacity 效果，不会触发 layout 和 paint</li></ul></li></ul> <h3 id="减少内存泄漏"><a href="#减少内存泄漏" class="header-anchor">#</a> 减少内存泄漏</h3> <ul><li><p><a href="https://mp.weixin.qq.com/s?__biz=MzUxMzcxMzE5Ng==&amp;mid=2247496779&amp;idx=2&amp;sn=892d968a86ebd083582ae2e28f48ab8f&amp;chksm=f9524108ce25c81e960471a63357cf2bc59971e2a22ca9549f67c5266100474712fcaa208f28&amp;mpshare=1&amp;scene=1&amp;srcid=&amp;sharer_sharetime=1592813500572&amp;sharer_shareid=f72feefcc9c2c137677aa7f49d02e0f4&amp;key=5275bdb85f6fecb5b863a0f4364938b0f20d3068a623c70bb17408602e09ad9840bc8824054c5f5f3e8b5fdacdf41cf6d13413049806b41cdb497e6abe7e48742dabb92c99874d17f7c19bace4019ecd&amp;ascene=1&amp;uin=MjI1NjQ0MTU1&amp;devicetype=Windows+7+x64&amp;version=62090523&amp;lang=zh_CN&amp;exportkey=AZvo2t51y73c8EhAeN7gjAk%3D&amp;pass_ticket=KfXN%2BILZIw36ijjDu%2F7KSM38UJxJ2Cjf8FTYPf6jp%2Fg%3D" target="_blank" rel="noopener noreferrer">参考<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li> <li><p>价值：保持小内存开销，有利于用户体验；避免因为内存泄漏，导致浏览器奔溃；</p></li> <li><p>内存泄漏往往会发生在使用 Vue 之外的其它进行 <strong>DOM 操作</strong>的三方库时。请在适当的时机做必要的组件清理，比如 beforeDestroy 钩子中。</p></li> <li><p>查看内存泄露：</p> <ul><li><p>Chrome 中的 Performance 面板，可视化查看内存的变化情况，找出异常点。
<img src="/assets/img/JS-heap-check.ecc0dbfe.png" alt="JS-heap-check"></p> <ul><li>打开开发者工具，选择 Performance 面板</li> <li>在顶部勾选 Memory</li> <li>点击左上角的录制按钮 Record。</li> <li>在页面上进行各种操作，模拟用户的使用情况。</li> <li>一段时间后，点击对话框的 stop 按钮，面板上就会显示这段时间的内存占用情况。</li> <li>关注 JS Heap，看到起点不断增高而没有释放内存，可能出现异常，点击预览图蓝色线增高点，看看执行了什么操作。去对应的函数中排查代码。</li></ul></li> <li><p>Chrome 中的 Memory 面板，可查看活动的 Javascript 对象（以及 DOM 节点）在内存中的分布
<img src="/assets/img/JS-heap-2.70a77d4c.png" alt="JS-heap-2"></p> <ul><li>Heap snapshot 堆快照，可截操作前后的内存快照，进行对比分析。</li> <li>on timeline 时间线，可开始录制操作，执行一段操作，选择内存增大的时间点分析。</li></ul></li></ul></li> <li><p><a href="https://www.jianshu.com/p/f27b27167125" target="_blank" rel="noopener noreferrer">分析 Chrome 性能调试工具 Timeline 简介<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li></ul> <blockquote><p>下面是可能导致内存泄漏的情况及预防</p></blockquote> <ul><li>滥用全局变量: 如未声明的变量，在函数中滥用 this 指向全局对象，无法被回收
<ul><li>预防：使用严格模式（&quot;use strict&quot;）</li></ul></li> <li>闭包(返回子函数): 父执行完后，子函数中引用父的变量无法被释放，导致引用的变量被保留。
<ul><li>预防：会用到，但要知道何时创建，保留哪些对象</li></ul></li> <li>定时器: 未被正确关闭，导致所引用的外部变量无法被释放
<ul><li>预防：必要时销毁定时器如 clearInterval</li></ul></li> <li>事件监听: 没有正确销毁，如使用监听执行匿名函数，无法使用 removeEventListener() 将其删除<div class="language-js extra-class"><pre class="language-js"><code>document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;keyup&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">doSomething</span><span class="token punctuation">(</span>hugeString<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>预防：
<ul><li>将执行函数的引用传递进 removeEventListener，来注销事件监听。</li> <li>还可以使用 addEventListener() 第三个参数<code>{once: true}</code>，在处理一次事件后，将自动删除侦听器函数。</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">listener</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">doSomething</span><span class="token punctuation">(</span>hugeString<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;keyup&quot;</span><span class="token punctuation">,</span> listener<span class="token punctuation">)</span><span class="token punctuation">;</span>
document<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;keyup&quot;</span><span class="token punctuation">,</span> listener<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li></ul></li> <li>DOM 引用: 在全局中对 DOM 节点的直接引用，删除该 DOM 节点，也不会被垃圾回收<div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">createElement</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> div <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;div&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  div<span class="token punctuation">.</span>id <span class="token operator">=</span> <span class="token string">&quot;detached&quot;</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> div<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> detachedDiv <span class="token operator">=</span> <span class="token function">createElement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>detachedDiv<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// this will keep referencing the DOM element even after deleteElement() is called</span>
</code></pre></div><ul><li>预防：
<ul><li>使用弱引用 WeakSet 和 WeakMap 保存 DOM 的引用</li> <li>将对 DOM 的引用移入函数局部作用域，函数使用完，局部变量对 DOM 的引用被销毁。</li></ul></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">createElement</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">appendElement</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> detachedDiv <span class="token operator">=</span> <span class="token function">createElement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// DOM的引用放在函数内</span>
    document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>detachedDiv<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">appendElement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li> <li>React 常见内存泄漏
<ul><li>卸载组件，异步请求未取消</li> <li>卸载组件，事件监听未取消</li> <li>卸载组件，定时任务未清除</li> <li>console.log 打印错误，保持了对 DOM 的引用</li></ul></li></ul> <h3 id="减少长时间任务"><a href="#减少长时间任务" class="header-anchor">#</a> 减少长时间任务</h3> <p><img src="/assets/img/chrome-devtools-2.a9def8a2.png" alt=""></p> <ul><li>看看有没有 long task，这上面带红色三角的就是 chrome 认为过长的任务，会在主线程阻塞渲染，先看看为什么长，看一下 js 的堆栈信息，如果有代码运算大的情况先考虑是否有不合理的地方可以优化</li> <li>再者就是切分任务了，把一个过长的任务切分成多个，解决主线程耗时过长的问题。</li></ul> <h3 id="节流防抖【参考-js-章节】"><a href="#节流防抖【参考-js-章节】" class="header-anchor">#</a> 节流防抖【参考 JS 章节】</h3> <h3 id="大数据长列表性能"><a href="#大数据长列表性能" class="header-anchor">#</a> 大数据长列表性能</h3> <blockquote><p>前端渲染大量数据上千行，不允许分页情况下，容易导致卡顿，掉帧现象。</p></blockquote> <ul><li><p>解决方案：</p> <ul><li>虚拟列表 - 只渲染可视区域的数据</li> <li>时间分片 - 使用 setTimeout 拆分密集型任务</li> <li>Web Worker - 与主线程并行的独立线程，通过 onmessage 和 postMessage 接口进行通信，完成大量的数据计算，结果返回主线程，由主线程更新 DOM 元素。</li> <li>触底请求分页+节流优化滚动(允许分页请求条件下)</li></ul></li> <li><p>常见场景：</p> <ul><li>插件关联时：不选择对应品类的话，会展示所有品类的全部版本插件，每个插件可能是几十上百个版本，所有品类最多可上万条版本数据供关联。</li></ul></li></ul> <h4 id="长列表渲染-虚拟列表-✨"><a href="#长列表渲染-虚拟列表-✨" class="header-anchor">#</a> 长列表渲染-虚拟列表 ✨</h4> <ul><li><p>原因：DOM 元素的创建和渲染时间成本很高,大数据完整渲染列表比较慢。</p></li> <li><p>场景：适用复杂情况的列表 item，如 element-ui 组件</p></li> <li><p>原理：从总数据取一部分数据，只对「可见区域」进行渲染，不可见部分不渲染。</p></li> <li><p>步骤：基于 Vue</p></li> <li><p>item 高度相同同情况下：</p> <ul><li>创建容器：在容器中创建两块元素，一个是真实可视列表，一个是不可见的元素撑开列表，使用计算属性根据列表数据计算这个不可见元素整个高度，占位让列表滚动条出现。computed:{ contentHeight() { return this.data.length * itemHeight + 'px' } }</li> <li>监听滚动：scrollTop 表示已滚出屏幕的高度。监听最外的容器滚动：@scroll=&quot;handleScroll&quot;</li> <li>执行更新：计算高度 const scrollTop = this.$el.scrollTop; 再执行下面 update(scrollTop)方法，更新可视区域数据。
<ul><li>计算可视区域放数据的个数 const visibleCount = Math.ceil(this.$el.clientHeight / this.itemHeight);</li> <li>计算可视区域的起始 item 坐标 start （比如 0）const start = Math.floor(scrollTop / this.itemHeight); 向下取整</li> <li>计算可视区域的结束 item 坐标 end （比如 10） const end = start + visibleCount;</li> <li>取出需要显示的数据，并更新渲染 this.visibleData = this.data.slice(start, end);</li> <li>把可见区域的 top 设置为起始元素在整个列表中的位置，也就是向下滚动 this.$refs.content.style.transform = <code>translateY(${ start \* this.itemHeight }px)</code>;</li></ul></li></ul></li> <li><p>item 高度不同（动态高度）情况下：<code>Element.getBoundingClientRect</code>返回元素的大小和相对于视口的位置</p> <ul><li>方案：传入预估高度属性先渲染部分数据，在<strong>updated</strong>钩子中，使用<strong>getBoundingClientRect</strong>获取每一个节点真实高度和 top 和 bottom，存放在一个列表中维护，并缓存下来，根据和预估高度的差值，进行调整，然后使用偏移量执行向下移动。
<ul><li>定义一个<code>props :estimatedItemSize</code> 预估高度</li> <li>定义一个<code>this.positions = [ {top:0,bottom:100,height:100} ,{...}]</code>保存每一项的高度及位置信息</li> <li>执行初始化，将预估高度保存入 positions 里，里面有高度、top、bottom</li> <li>列表总高度 contentHeight：最后一项距离列表顶部的位置<code>this.positions[this.positions.length - 1].bottom;</code></li> <li>渲染后，<strong>获取真实位置并缓存</strong>：在 updated 钩子里，遍历列表 item 的数组，获取每个 node 节点的高度<strong>getBoundingClientRect.height</strong>，与预估高度进行对比，如果有差值，进行 bottom 减去这个差值。height 替换为新的 height。更新所有后面的项位置。</li> <li>屏幕显示的数量 visibleCount：<code>Math.ceil(this.screenHeight / this.estimatedItemSize);</code></li> <li>查找起始 item：遍历 positions，找到 bottom&gt;scrollTop 的第一项（bottom 是从小到大递增的，这里可用二分法查找优化）</li> <li>偏移量 offset：<code>this.offset = this.positions[this.start - 1].bottom</code>，再执行向下滚动 this.$refs.content.style.transform = <code>translateY(${ offset }px)</code></li> <li>查找结束坐标：<code>this.end = this.start + this.visibleCount</code>;</li></ul></li> <li>滚动太快导致白屏的解决方案：
<ul><li>可见区域的上方和下方渲染额外的项目，而不是刚好卡着屏幕能显示的数量。</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">visibleData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">let</span> start <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>start <span class="token operator">-</span> <span class="token keyword">this</span><span class="token punctuation">.</span>aboveCount<span class="token punctuation">;</span>
  <span class="token keyword">let</span> end <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>end <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>belowCount<span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_listData<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>start<span class="token punctuation">,</span> end<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ul></li></ul> <h4 id="长列表渲染-时间切片"><a href="#长列表渲染-时间切片" class="header-anchor">#</a> 长列表渲染-时间切片</h4> <ul><li>原因：DOM 元素的创建和渲染时间成本很高,大数据完整渲染列表比较慢。</li> <li>场景：大量简单的 dom</li> <li>原理：延时加载，setTimeout（回调与系统刷新不一致会有闪屏现象）或 window.requestAnimationFrame 进行分批渲染</li> <li>window.requestAnimationFrame(回调函数执行与浏览器刷新频率保持一致，通常是每秒 60 次，更优)下次重绘之前继续更新下一帧动画</li> <li>FPS 表示每秒钟画面更新次数，大多数显示器的刷新频率是 60Hz，相当于每秒钟重绘 60 次，人眼睛有视觉停留效应，间隔时间太短 16.7ms（1000/60 ms）让你以为屏幕的图像是禁止的。 50 ～ 60 FPS 的动画将会相当流畅，帧率在 30 FPS 以下的动画，明显的卡顿和不适感；</li> <li>实现：</li></ul> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>container<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text/javascript<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">let</span> ul <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;container&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 总数</span>
  <span class="token keyword">let</span> total <span class="token operator">=</span> <span class="token number">50000</span><span class="token punctuation">;</span>
  <span class="token comment">// 一次插入 20 条</span>
  <span class="token keyword">let</span> once <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span>
  <span class="token comment">// 每条记录的索引</span>
  <span class="token keyword">let</span> index <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

  <span class="token comment">//循环加载数据</span>
  <span class="token keyword">function</span> <span class="token function">loop</span><span class="token punctuation">(</span><span class="token parameter">curTotal<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>curTotal <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//每页多少条</span>
    <span class="token keyword">let</span> pageCount <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>curTotal<span class="token punctuation">,</span> once<span class="token punctuation">)</span><span class="token punctuation">;</span>
    window<span class="token punctuation">.</span><span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> pageCount<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> li <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;li&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        li<span class="token punctuation">.</span>innerText <span class="token operator">=</span> index <span class="token operator">+</span> <span class="token string">&quot;:&quot;</span> <span class="token operator">+</span> i <span class="token operator">+</span> <span class="token string">&quot;:&quot;</span> <span class="token operator">+</span> <span class="token operator">~</span><span class="token operator">~</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> total<span class="token punctuation">)</span><span class="token punctuation">;</span>
        ul<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>li<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token comment">// 添加下一批数据</span>
      <span class="token function">loop</span><span class="token punctuation">(</span>curTotal <span class="token operator">-</span> pageCount<span class="token punctuation">,</span> index <span class="token operator">+</span> pageCount<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">loop</span><span class="token punctuation">(</span>total<span class="token punctuation">,</span> index<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="web-worker-多线程"><a href="#web-worker-多线程" class="header-anchor">#</a> Web Worker 多线程</h3> <p>现代浏览器为 JavaScript 创造的 多线程环境。<strong>可以将复杂计算任务分配到 worker 线程并行运行，等 worker 完成计算任务，再将结果返回主线程</strong>，两个线程可 独立运行，互不干扰，可通过自带的 <strong>消息机制</strong> 相互通信，为了节省系统资源，使用完毕记得关闭。</p> <ul><li><p>基本用法:</p> <ul><li><p>主线程</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> worker <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Worker</span><span class="token punctuation">(</span><span class="token string">&quot;work.js&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 来自网络的js文件</span>
worker<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token string">&quot;Hello World&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//主线程传给 Worker 的数据</span>
worker<span class="token punctuation">.</span><span class="token function-variable function">onmessage</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">//监听函数，接收子线程发回来的消息</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Received message&quot;</span> <span class="token operator">+</span> event<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// 错误监控</span>
worker<span class="token punctuation">.</span><span class="token function">onerror</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>
    <span class="token punctuation">[</span><span class="token string">&quot;ERROR: Line &quot;</span><span class="token punctuation">,</span> e<span class="token punctuation">.</span>lineno<span class="token punctuation">,</span> <span class="token string">&quot; in &quot;</span><span class="token punctuation">,</span> e<span class="token punctuation">.</span>filename<span class="token punctuation">,</span> <span class="token string">&quot;: &quot;</span><span class="token punctuation">,</span> e<span class="token punctuation">.</span>message<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

worker<span class="token punctuation">.</span><span class="token function">terminate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//任务完成，关闭</span>
</code></pre></div></li> <li><p>Worker 线程(self 代表子线程自身，即子线程的全局对象)</p> <div class="language-js extra-class"><pre class="language-js"><code>self<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span>
  <span class="token string">&quot;message&quot;</span><span class="token punctuation">,</span>
  <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 监听message事件</span>
    self<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token string">&quot;You said: &quot;</span> <span class="token operator">+</span> e<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// self.postMessage()方法用来向主线程发送消息。</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token boolean">false</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 示例：</span>
self<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span>
  <span class="token string">&quot;message&quot;</span><span class="token punctuation">,</span>
  <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> data <span class="token operator">=</span> e<span class="token punctuation">.</span>data<span class="token punctuation">;</span>
    <span class="token keyword">switch</span> <span class="token punctuation">(</span>data<span class="token punctuation">.</span>cmd<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">case</span> <span class="token string">&quot;start&quot;</span><span class="token operator">:</span>
        self<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token string">&quot;WORKER STARTED: &quot;</span> <span class="token operator">+</span> data<span class="token punctuation">.</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
      <span class="token keyword">case</span> <span class="token string">&quot;stop&quot;</span><span class="token operator">:</span>
        self<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token string">&quot;WORKER STOPPED: &quot;</span> <span class="token operator">+</span> data<span class="token punctuation">.</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
        self<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// self.close()用于在 Worker 内部关闭自身。</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
      <span class="token keyword">default</span><span class="token operator">:</span>
        self<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token string">&quot;Unknown command: &quot;</span> <span class="token operator">+</span> data<span class="token punctuation">.</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token boolean">false</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 加载其他脚本：</span>
<span class="token function">importScripts</span><span class="token punctuation">(</span><span class="token string">&quot;script1.js&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;script2.js&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li></ul></li> <li><p>API
主线程</p></li></ul> <div class="language-js extra-class"><pre class="language-js"><code>Worker<span class="token punctuation">.</span>onerror：指定 error 事件的监听函数。
Worker<span class="token punctuation">.</span>onmessage：指定 message 事件的监听函数，发送过来的数据在Event<span class="token punctuation">.</span>data属性中。
Worker<span class="token punctuation">.</span>onmessageerror：指定 messageerror 事件的监听函数。发送的数据无法序列化成字符串时，会触发这个事件。
Worker<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span>：向 Worker 线程发送消息。
Worker<span class="token punctuation">.</span><span class="token function">terminate</span><span class="token punctuation">(</span><span class="token punctuation">)</span>：立即终止 Worker 线程。
</code></pre></div><p>Worker</p> <div class="language-js extra-class"><pre class="language-js"><code>self<span class="token punctuation">.</span>name： Worker 的名字。该属性只读，由构造函数指定。
self<span class="token punctuation">.</span>onmessage：指定message事件的监听函数。
self<span class="token punctuation">.</span>onmessageerror：指定 messageerror 事件的监听函数。发送的数据无法序列化成字符串时，会触发这个事件。
self<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>：关闭 Worker 线程。
self<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span>：向产生这个 Worker 线程发送消息。
self<span class="token punctuation">.</span><span class="token function">importScripts</span><span class="token punctuation">(</span><span class="token punctuation">)</span>：加载 <span class="token constant">JS</span> 脚本。
</code></pre></div><ul><li>优势：
<ul><li>能够执行处理器密集型的运算而不会阻塞 UI 线程。</li></ul></li> <li>限制:
<ul><li>同源限制：与主线程的脚本同源</li> <li>DOM 限制：无法使用 document / window / alert / confirm</li> <li>文件限制：无法读取本地资源</li></ul></li></ul> <h2 id="vue-项目优化"><a href="#vue-项目优化" class="header-anchor">#</a> Vue 项目优化</h2> <h3 id="加载时-3"><a href="#加载时-3" class="header-anchor">#</a> 加载时</h3> <ul><li>预渲染(Prerender)或服务端渲染(SSR)
<ul><li>参考上方</li></ul></li></ul> <h3 id="运行时-3"><a href="#运行时-3" class="header-anchor">#</a> 运行时</h3> <ul><li><p>指令场景</p> <ul><li>v-if(条件渲染)用在条件较少改变的场景，v-show(display 切换)用在频繁切换的场景</li> <li>v-for 遍历要加 key(提高 diff 速度)，v-for 遍历避免同时使用 v-if(v-for 比 v-if 优先级高，每次都会遍历)</li> <li>computed 用于进行依赖数值的计算，有缓存。用 watch 用于执行监听数据变化后的回调，可异步。</li></ul></li> <li><p>Object.freeze()冻结对象</p> <ul><li>阻止了 Vue 使用数据劫持（用 Object.defineProperty 重写 setter 和 getter）</li> <li>因为冻结后，不能添加、删除、修改属性值，不能修改可写性、可枚举性等。</li> <li>适合只是展示的场景，数据不会改变，如大数据表格。</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      users<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token keyword">async</span> <span class="token function">created</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> users <span class="token operator">=</span> <span class="token keyword">await</span> axios<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;/api/users&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>users <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">freeze</span><span class="token punctuation">(</span>users<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div></li> <li><p>扁平化接口返回的数据</p> <ul><li>JSON 数据规范化（normalize），将深层嵌套的 JSON 对象通过定义好的 schema 转变成使用 id 表示的对象，如用户 user 数组集中使用 id 来存放信息，在评论也是写上 id 即可表示是哪个用户评论，快速在 user 数组即可找到这个用户的信息。</li></ul></li> <li><p>路由懒加载</p> <ul><li>参考上方</li></ul></li> <li><p>组件级别懒加载</p> <ul><li>参考上方</li></ul></li> <li><p>虚拟列表</p> <ul><li>参考上方</li></ul></li> <li><p>启用 Vue 的生产环境模式 【Vue CLI 默认开启】</p> <ul><li>Vue 源码会根据 process.env.NODE_ENV 决定是否启用生产环境模式，同时构建过程的警告也会被压缩工具去除。</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// webpack4 + 使用mode选项配置production</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  mode<span class="token operator">:</span> <span class="token string">&quot;production&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div></li> <li><p>使用单文件组件(.vue)预编译模板 【Vue CLI 默认开启】</p> <ul><li>写好的代码自动预编译，包含编译好的渲染函数而不是模板字符串。</li></ul></li> <li><p>提取组件的 CSS 【Vue CLI 默认开启】</p> <ul><li>单文件组件时，组件内的 CSS 会以 <code>&lt;style&gt;</code> 标签的方式通过 JavaScript 动态注入，使用插件 extract-text-webpack-plugin + <code>vue-loader</code>将所有组件的 CSS 提取到一个文件中。</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// webpack.config.js</span>
<span class="token keyword">var</span> ExtractTextPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;extract-text-webpack-plugin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// other options...</span>
  module<span class="token operator">:</span> <span class="token punctuation">{</span>
    rules<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.vue$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        loader<span class="token operator">:</span> <span class="token string">&quot;vue-loader&quot;</span><span class="token punctuation">,</span>
        options<span class="token operator">:</span> <span class="token punctuation">{</span>
          extractCSS<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token keyword">new</span> <span class="token class-name">ExtractTextPlugin</span><span class="token punctuation">(</span><span class="token string">&quot;style.css&quot;</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div></li></ul> <h2 id="h5-的优化"><a href="#h5-的优化" class="header-anchor">#</a> H5 的优化</h2> <p><a href="https://juejin.cn/post/6994383328182796295#heading-21" target="_blank" rel="noopener noreferrer">腾讯企鹅辅导 H5 优化<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <ul><li><p>模拟设备</p> <ul><li>安装 vConsole</li> <li>Web 端通过 performance 模拟移动端，设置慢倍速， CPU 为 4x slowdown 或 6x slowdown</li> <li>模拟弱网情况 slow 3g</li> <li>使用代理 whistle，在手机端跑本地代码，看看优化效果</li></ul></li> <li><p>分析</p> <ul><li>查看 FCP 指标和 long task</li> <li>lighthouse 分析，可以看 TTI 可交互事件，LCP 最大文本块内容展示在页面中的时间</li></ul></li></ul></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/pages/folder1/monitor.html" class="prev">
        监控体系
      </a></span> <span class="next"><a href="/pages/folder1/design-pattern.html">
        设计模式和架构
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.d50c72b0.js" defer></script><script src="/assets/js/2.7285e602.js" defer></script><script src="/assets/js/7.7f87f0fb.js" defer></script>
  </body>
</html>
